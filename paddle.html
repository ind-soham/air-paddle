<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Air Paddle - AI Arcade</title>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
  <style>
    body { background-color: #222; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
    canvas { border: 4px solid #00d4ff; border-radius: 10px; transform: scaleX(-1); max-width: 100%; }
    #status { position: absolute; top: 20px; font-size: 24px; background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 20px; }
    .back-btn { position: absolute; top: 20px; left: 20px; color: white; text-decoration: none; font-family: sans-serif; background: #444; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <a href="index.html" class="back-btn">‚Üê Back to Menu</a>
  <div id="status">Loading AI...</div>
  <video class="input_video" style="display:none"></video>
  <canvas class="output_canvas" width="640" height="480"></canvas>

  <script>
    const video = document.getElementsByClassName('input_video')[0];
    const canvas = document.getElementsByClassName('output_canvas')[0];
    const ctx = canvas.getContext('2d');
    const status = document.getElementById('status');

    let paddleX = 320;
    let ballX = 320, ballY = 0, ballSpeed = 5, score = 0;
    
    // --- Hand Tracking ---
    function onResults(results) {
        status.style.display = 'none';
        ctx.save();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);
        
        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            let hand = results.multiHandLandmarks[0];
            let indexTip = hand[8]; // Index Finger Tip
            paddleX = indexTip.x * canvas.width;
            
            // Draw marker on finger
            ctx.beginPath();
            ctx.arc(indexTip.x * canvas.width, indexTip.y * canvas.height, 10, 0, 2*Math.PI);
            ctx.fillStyle = "yellow";
            ctx.fill();
        }

        // --- Game Logic ---
        ballY += ballSpeed;
        
        // Paddle Collision
        if (ballY > 440 && ballY < 460 && Math.abs(ballX - paddleX) < 50) {
            ballY = 0;
            ballX = Math.random() * canvas.width;
            score++;
            ballSpeed += 0.5;
        }
        
        // Reset if miss
        if (ballY > 480) {
            ballY = 0;
            ballX = Math.random() * canvas.width;
            score = 0;
            ballSpeed = 5;
        }

        // Draw Paddle
        ctx.fillStyle = "#00d4ff";
        ctx.fillRect(paddleX - 50, 440, 100, 20);

        // Draw Ball
        ctx.beginPath();
        ctx.arc(ballX, ballY, 15, 0, 2*Math.PI);
        ctx.fillStyle = "#ff0055";
        ctx.fill();

        // Draw Score (flipped back)
        ctx.scale(-1, 1);
        ctx.fillStyle = "white";
        ctx.font = "30px Arial";
        ctx.fillText("Score: " + score, -140, 50);
        ctx.restore();
    }

    const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({maxNumHands: 1, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5});
    hands.onResults(onResults);

    const camera = new Camera(video, {
        onFrame: async () => { await hands.send({image: video}); },
        width: 640, height: 480
    });
    camera.start();
  </script>
</body>
</html>
